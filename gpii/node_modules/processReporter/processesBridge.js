/*!
GPII Process Reporter processes bridge -- gpii.processes.

Copyright 2014-2016 Inclusive Design Research Centre, OCAD University

Licensed under the New BSD license. You may not use this file except in
compliance with this License.

You may obtain a copy of the License at
https://github.com/gpii/universal/LICENSE.txt
*/

/*global require */

(function () {
    "use strict";

    var fluid = require("universal");
    var ref = require("ref");

    var gpii = fluid.registerNamespace("gpii");
    var windows = fluid.registerNamespace("gpii.windows");
    var windowsUtils = require("../WindowsUtilities/WindowsUtilities.js");
    var c = windows.API_constants;

    gpii.processes = fluid.registerNamespace("gpii.processes");

    fluid.defaults("gpii.processes.native", {
        gradeNames: ["fluid.component"],
        invokers: {
            getProcessList: {
                funcName: "gpii.processes.native.getProcessList",
                args: []
            }
        }
    });

    // Return a list of processes -- a snapshot of the current processes.
    // Note: Should the bulk of this go into WindowUtilities?
    gpii.processes["native"].getProcessList = function () {
        var processes = [];
        var windowsProcesses = windows.processesSnapshot();
        fluid.each(windowsProcesses, function (windowsProcess, index) {
            var procInfo = {};
            procInfo.command = windowsProcess.name || windowsProcess.execFile;
            procInfo.pid = windowsProcess.pid;
//          proceInfo.argv = ???;

            // If it's in the list, it's running. But there must be a better way
            // using the windowsProcess's threads.
            procInfo.state = "Running";
            procInfo.fullPath = windowsProcess.fullPath;
            processes.push(procInfo);
        });
        return processes;
    };
    
    // for debugging:
    var procList = gpii.processes["native"].getProcessList();
    console.log ("");
    console.log (procList);
}());
